# MongoDB Configuration File
# Generated by Ansible - DO NOT EDIT MANUALLY
# {{ ansible_managed }}

# Storage Configuration
storage:
  dbPath: {{ mongodb_data_dir }}
  journal:
    enabled: {{ mongodb_journal_enabled | lower }}
  engine: {{ mongodb_storage_engine }}
{% if mongodb_storage_engine == 'wiredTiger' %}
  wiredTiger:
    engineConfig:
      cacheSizeGB: {{ mongodb_cache_size_gb }}
{% if mongodb_enable_ssl %}
      configString: "encryption=(name=AES256-CBC,keyid=mongodb)"
{% endif %}
{% endif %}

# System Log Configuration
systemLog:
  destination: file
  path: {{ mongodb_log_dir }}/mongod.log
  logAppend: {{ mongodb_log_append | lower }}
  logRotate: {{ mongodb_log_rotation }}
  verbosity: 0

# Network Configuration
net:
  bindIp: {{ mongodb_bind_ip }}
  port: {{ mongodb_port }}
  maxIncomingConnections: {{ mongodb_max_connections }}
{% if mongodb_enable_ssl %}
  tls:
    mode: {{ mongodb_ssl_mode }}
    certificateKeyFile: {{ mongodb_ssl_server_cert }}
    CAFile: {{ mongodb_ssl_ca_cert }}
    allowConnectionsWithoutCertificates: true
    allowInvalidCertificates: false
    allowInvalidHostnames: false
{% endif %}

# Process Management
processManagement:
  fork: true
  pidFilePath: {{ mongodb_pid_file }}
  timeZoneInfo: /usr/share/zoneinfo

# Security Configuration
{% if mongodb_enable_auth %}
security:
  authorization: enabled
  keyFile: {{ mongodb_keyfile_path }}
{% if mongodb_enable_ssl %}
  clusterAuthMode: x509
{% endif %}
{% endif %}

# Replication Configuration
replication:
  replSetName: {{ mongodb_replica_set_name }}
  oplogSizeMB: {{ mongodb_oplog_size_mb }}

# Operation Profiling
operationProfiling:
  slowOpThresholdMs: {{ mongodb_slow_op_threshold_ms }}
  mode: slowOp

# Set Parameter Configuration
setParameter:
  enableLocalhostAuthBypass: false
  authenticationMechanisms: {{ mongodb_auth_mechanism }}
