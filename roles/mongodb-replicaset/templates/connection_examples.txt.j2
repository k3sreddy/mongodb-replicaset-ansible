# MongoDB Connection Examples
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

## Basic Connection (MongoDB Shell)
mongosh "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{{ ansible_default_ipv4.address }}:{{ mongodb_port }}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}"

## Replica Set Connection
mongosh "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{% for host in groups['mongodb'] %}{{ hostvars[host]['ansible_host'] }}:{{ mongodb_port }}{% if not loop.last %},{% endif %}{% endfor %}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&replicaSet={{ mongodb_replica_set_name }}"

{% if mongodb_enable_ssl %}
## TLS/SSL Connection
mongosh "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{{ ansible_default_ipv4.address }}:{{ mongodb_port }}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&tls=true&tlsCAFile={{ mongodb_ssl_ca_cert }}"

## Replica Set with TLS/SSL
mongosh "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{% for host in groups['mongodb'] %}{{ hostvars[host]['ansible_host'] }}:{{ mongodb_port }}{% if not loop.last %},{% endif %}{% endfor %}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&replicaSet={{ mongodb_replica_set_name }}&tls=true&tlsCAFile={{ mongodb_ssl_ca_cert }}"
{% endif %}

## Application Connection Strings

### Node.js (MongoDB Driver)
```javascript
const { MongoClient } = require('mongodb');
const uri = "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{% for host in groups['mongodb'] %}{{ hostvars[host]['ansible_host'] }}:{{ mongodb_port }}{% if not loop.last %},{% endif %}{% endfor %}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&replicaSet={{ mongodb_replica_set_name }}{% if mongodb_enable_ssl %}&tls=true{% endif %}";
const client = new MongoClient(uri);
```

### Python (PyMongo)
```python
from pymongo import MongoClient
uri = "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{% for host in groups['mongodb'] %}{{ hostvars[host]['ansible_host'] }}:{{ mongodb_port }}{% if not loop.last %},{% endif %}{% endfor %}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&replicaSet={{ mongodb_replica_set_name }}{% if mongodb_enable_ssl %}&tls=true{% endif %}"
client = MongoClient(uri)
```

### Java (MongoDB Driver)
```java
String uri = "mongodb://{{ mongodb_admin_username }}:{{ mongodb_admin_password }}@{% for host in groups['mongodb'] %}{{ hostvars[host]['ansible_host'] }}:{{ mongodb_port }}{% if not loop.last %},{% endif %}{% endfor %}/{{ mongodb_admin_database }}?authSource={{ mongodb_admin_database }}&replicaSet={{ mongodb_replica_set_name }}{% if mongodb_enable_ssl %}&tls=true{% endif %}";
MongoClient mongoClient = MongoClients.create(uri);
```

## Useful Commands

### Check replica set status
rs.status()

### Check replica set configuration
rs.conf()

### Check database users
use {{ mongodb_admin_database }}
db.runCommand({usersInfo: 1})

### Monitor replication lag
rs.printSecondaryReplicationInfo()

### Check server status
db.serverStatus()
